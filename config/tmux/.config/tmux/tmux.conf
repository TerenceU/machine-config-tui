# ========================================
# Tmux Configuration
# ========================================

# Set prefix to Ctrl+a (più comodo di Ctrl+b)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Enable mouse support
set -g mouse on

# ========================================
# VI MODE & COPY MODE (quello che volevi!)
# ========================================

# Use vi keybindings in copy mode
setw -g mode-keys vi

# Enter copy mode with Ctrl+a [  (o anche Alt+[)
bind [ copy-mode
bind Escape copy-mode

# In copy mode:
# v = start selection (visual mode)
# y = copy selection to system clipboard
# C-v = rectangle selection
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "wl-copy"
bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "wl-copy"

# ESC to exit copy mode or cancel selection
bind -T copy-mode-vi Escape send-keys -X cancel

# ========================================
# THEME & APPEARANCE (Gruvbox style)
# ========================================

# True color support
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Status bar colors (gruvbox dark)
set -g status-style bg=#282828,fg=#ebdbb2
set -g status-left-style bg=#282828,fg=#fe8019
set -g status-right-style bg=#282828,fg=#fe8019

# Window status colors
setw -g window-status-current-style bg=#fe8019,fg=#282828,bold
setw -g window-status-style bg=#3c3836,fg=#a89984

# Pane border colors
set -g pane-border-style fg=#3c3836
set -g pane-active-border-style fg=#fe8019

# Message colors
set -g message-style bg=#fe8019,fg=#282828

# Status bar content
set -g status-left-length 30
set -g status-left "#{?client_prefix,#[bg=#fe8019]#[fg=#282828] PREFIX ,#[bg=#3c3836]#[fg=#fe8019]} [#S] "
set -g status-right "#[fg=#fe8019]%H:%M #[fg=#a89984]%d-%b "
set -g status-interval 1

# ========================================
# OTHER SETTINGS
# ========================================

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Faster escape time
set -sg escape-time 0

# Increase scrollback buffer
set -g history-limit 10000

# Easy config reload
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded!"

# Better split commands
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Scroll up/down with Ctrl+Shift+K/J (riga per riga)
# K entra in copy-mode e scrolla su
# J scrolla giù (se già in copy-mode)
bind -n C-S-k copy-mode \; send-keys -X scroll-up
bind -n C-S-j if-shell -F "#{pane_in_mode}" "send-keys -X scroll-down" ""

# ========================================
# WINDOW NAVIGATION (Tab-like behavior)
# ========================================

# Ctrl+Shift+[1-9] to switch to window N
bind -n C-S-1 select-window -t 1
bind -n C-S-2 select-window -t 2
bind -n C-S-3 select-window -t 3
bind -n C-S-4 select-window -t 4
bind -n C-S-5 select-window -t 5
bind -n C-S-6 select-window -t 6
bind -n C-S-7 select-window -t 7
bind -n C-S-8 select-window -t 8
bind -n C-S-9 select-window -t 9

# Ctrl+Shift+t to create new window (tab)
bind -n C-S-t new-window -c "#{pane_current_path}"

# Ctrl+Shift+d to close current window (tab)
bind -n C-S-d confirm-before -p "Chiudi finestra #W? (y/n)" kill-window

# Ctrl+Shift+n/p to navigate next/previous window
bind -n C-S-n next-window
bind -n C-S-p previous-window

# Ctrl+Shift+h/l to navigate previous/next window (vim-style)
bind -n C-S-h previous-window
bind -n C-S-l next-window

# Ctrl+Shift+r to rename current window
bind -n C-S-r command-prompt "rename-window '%%'"

# ========================================
# SESSION MANAGEMENT
# ========================================

# Ctrl+Shift+s to list and switch sessions (interactive)
bind -n C-S-s choose-session

# Ctrl+Shift+q to detach from session (non chiude, torna a shell)
bind -n C-S-q detach-client

# Ctrl+Shift+x to kill current session and switch to another (or exit if last one)
bind -n C-S-x confirm-before -p "Killare sessione #S? (y/n)" "run-shell 'tmux switch-client -n \\\; kill-session -t \"#S\"'"

# Mostra nome sessione più visibile nella status bar
set -g status-left-length 30
set -g status-left "#{?client_prefix,#[bg=#fe8019]#[fg=#282828] PREFIX ,#[bg=#3c3836]#[fg=#fe8019]} [#S] "
